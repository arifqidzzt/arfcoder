<div class="min-h-screen bg-gray-50/50 pb-20 pt-24" x-data="{ setupStep: 'idle', qr: '', secret: '', token: '' }">
    <div class="container mx-auto px-4 md:px-8 max-w-4xl">
        <div class="flex items-center gap-4 mb-10">
            <a href="/profile" class="p-2 bg-white rounded-full border border-gray-100 shadow-sm hover:bg-gray-50 transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            </a>
            <h1 class="text-3xl font-black uppercase tracking-tighter">Keamanan Akun</h1>
        </div>

        <div class="space-y-8">
            <!-- 2FA SECTION -->
            <div class="bg-white p-8 md:p-12 rounded-[3rem] border border-gray-100 shadow-soft">
                <div class="flex items-center gap-6 mb-10">
                    <div class="p-4 {{if .User.TwoFactorEnabled}}bg-green-100 text-green-600{{else}}bg-gray-100 text-gray-400{{end}} rounded-2xl transition-colors duration-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-black uppercase tracking-tighter">Google Authenticator</h2>
                        <p class="text-gray-400 text-sm font-medium">{{if .User.TwoFactorEnabled}}Status: AKTIF{{else}}Status: NON-AKTIF{{end}}</p>
                    </div>
                </div>

                <template x-if="setupStep === 'idle'">
                    <button 
                        @click="fetch('/api/auth/2fa/setup', { method: 'POST', headers: { 'Authorization': 'Bearer ' + '{{.Token}}' } }).then(r => r.json()).then(d => { qr = d.otpauth; secret = d.secret; setupStep = 'qr'; })"
                        class="px-8 py-4 {{if .User.TwoFactorEnabled}}bg-gray-100 text-black{{else}}bg-black text-white{{end}} rounded-2xl font-black uppercase text-xs tracking-widest hover:scale-[1.02] transition-all active:scale-95"
                    >
                        {{if .User.TwoFactorEnabled}}Ganti Authenticator{{else}}Aktifkan Sekarang{{end}}
                    </button>
                </template>

                <template x-if="setupStep === 'qr'">
                    <div class="space-y-8 animate-in fade-in zoom-in duration-500">
                        <div class="bg-gray-50 p-8 rounded-[2rem] border border-gray-100 flex flex-col md:flex-row gap-10 items-center">
                            <div class="bg-white p-4 rounded-2xl border-2 border-gray-100 shadow-inner">
                                <img :src="'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=' + encodeURIComponent(qr)" class="w-48 h-48" />
                            </div>
                            <div class="flex-1 space-y-4">
                                <p class="text-xs font-black text-gray-400 uppercase tracking-widest">Atau Masukkan Kode Manual:</p>
                                <code class="block w-full bg-white p-4 rounded-xl border border-gray-100 font-mono font-black text-xl tracking-[0.2em] text-center break-all select-all" x-text="secret"></code>
                            </div>
                        </div>

                        <div class="pt-8 border-t border-gray-100">
                            <p class="font-black text-sm uppercase tracking-tight mb-4">Langkah 2: Verifikasi 6-Digit</p>
                            <div class="flex gap-4">
                                <input type="text" x-model="token" placeholder="000000" class="w-32 p-4 bg-gray-50 border border-gray-100 rounded-2xl text-center font-black text-xl tracking-[0.3em] outline-none focus:ring-2 focus:ring-black/5" maxlength="6">
                                <button 
                                    @click="fetch('/api/auth/2fa/enable', { method: 'POST', headers: { 'Authorization': 'Bearer ' + '{{.Token}}', 'Content-Type': 'application/json' }, body: JSON.stringify({token: token}) }).then(r => r.ok ? window.location.reload() : toast('Kode Salah', 'error'))"
                                    class="flex-1 py-4 bg-black text-white rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-gray-800"
                                >
                                    Konfirmasi & Aktifkan
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- PASSWORD SECTION -->
            <div class="bg-white p-8 md:p-12 rounded-[3rem] border border-gray-100 shadow-soft">
                <h3 class="font-black text-sm uppercase tracking-widest text-gray-400 mb-8">Ganti Kata Sandi</h3>
                <form hx-put="/api/user/change-password" hx-ext="json-enc" hx-on::after-request="this.reset(); toast('Password berhasil diubah!')" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <input type="password" name="oldPassword" placeholder="Password Lama" required class="w-full p-4 bg-gray-50 border border-transparent rounded-2xl text-sm font-bold outline-none focus:bg-white focus:border-gray-100">
                        <input type="password" name="newPassword" placeholder="Password Baru" required class="w-full p-4 bg-gray-50 border border-transparent rounded-2xl text-sm font-bold outline-none focus:bg-white focus:border-gray-100">
                    </div>
                    <div class="flex justify-end">
                        <button type="submit" class="px-8 py-3 bg-black text-white text-[10px] font-black uppercase tracking-widest rounded-xl hover:bg-gray-800 transition-all">Ganti Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

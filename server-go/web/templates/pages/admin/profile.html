{{define "admin_content"}}
<!-- ADMIN PROFILE -->
<div x-data="adminProfile()">
    <h1 class="text-2xl font-bold mb-8">Admin Profile</h1>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Profile Info -->
        <div class="bg-white rounded-2xl border border-border p-6">
            <h2 class="font-bold text-lg mb-6">Informasi Akun</h2>
            <div class="flex items-center gap-4 mb-6">
                <div class="w-20 h-20 rounded-full overflow-hidden border-4 border-gray-100"><img
                        :src="user?.avatar || 'https://placehold.co/100'" class="w-full h-full object-cover"></div>
                <div>
                    <h3 class="font-bold text-xl" x-text="user?.name"></h3>
                    <p class="text-gray-500" x-text="user?.email"></p>
                </div>
            </div>
            <div class="space-y-4">
                <div><label class="text-sm text-gray-500">Nama</label><input type="text" x-model="form.name"
                        class="w-full mt-1 p-3 border rounded-xl"></div>
                <div><label class="text-sm text-gray-500">Email</label><input type="email" :value="user?.email" disabled
                        class="w-full mt-1 p-3 border rounded-xl bg-gray-50"></div>
            </div>
            <button @click="updateProfile()"
                class="mt-6 px-6 py-3 bg-black text-white rounded-xl font-medium">Simpan</button>
        </div>
        <!-- Security -->
        <div class="space-y-6">
            <!-- Change Password -->
            <div class="bg-white rounded-2xl border border-border p-6">
                <h2 class="font-bold text-lg mb-4">Ubah Password</h2>
                <div class="space-y-4">
                    <div><label class="text-sm text-gray-500">Password Lama</label><input type="password"
                            x-model="password.old" class="w-full mt-1 p-3 border rounded-xl"></div>
                    <div><label class="text-sm text-gray-500">Password Baru</label><input type="password"
                            x-model="password.new" class="w-full mt-1 p-3 border rounded-xl"></div>
                </div>
                <button @click="changePassword()" class="mt-4 px-6 py-2 bg-black text-white rounded-lg font-medium">Ubah
                    Password</button>
            </div>
            <!-- 2FA -->
            <div class="bg-white rounded-2xl border border-border p-6">
                <h2 class="font-bold text-lg mb-4">Two-Factor Authentication</h2>
                <p class="text-gray-600 text-sm mb-4">Tambahkan lapisan keamanan ekstra ke akun admin Anda.</p>
                <div class="flex items-center justify-between">
                    <span class="font-medium" x-text="twoFactorEnabled ? '2FA Aktif' : '2FA Nonaktif'"></span>
                    <button @click="toggle2FA()" class="px-4 py-2 rounded-lg font-medium"
                        :class="twoFactorEnabled ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'"
                        x-text="twoFactorEnabled ? 'Nonaktifkan' : 'Aktifkan'"></button>
                </div>
                <template x-if="showQR">
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg text-center">
                        <p class="text-sm mb-2">Scan dengan Google Authenticator:</p><img :src="qrCode"
                            class="mx-auto max-w-[150px]"><input type="text" x-model="verifyCode"
                            placeholder="Masukkan kode" class="mt-3 p-2 border rounded-lg w-full max-w-[200px]"><button
                            @click="verify2FA()"
                            class="mt-2 px-4 py-2 bg-black text-white rounded-lg">Verifikasi</button>
                    </div>
                </template>
            </div>
        </div>
    </div>
</div>
<script>
    function adminProfile() {
        return {
            get user() { return Alpine.store('app')?.user; },
            form: { name: '' }, password: { old: '', new: '' }, twoFactorEnabled: false, showQR: false, qrCode: '', verifyCode: '',
            init() { if (this.user) { this.form.name = this.user.name; this.twoFactorEnabled = this.user.twoFactorEnabled || false; } },
            async updateProfile() { try { await api.put('/user/profile', this.form); showToast('Profil diperbarui', 'success'); Alpine.store('app').checkAuth(); } catch (e) { showToast(e.message, 'error'); } },
            async changePassword() { try { await api.put('/user/password', { oldPassword: this.password.old, newPassword: this.password.new }); showToast('Password diubah', 'success'); this.password = { old: '', new: '' }; } catch (e) { showToast(e.message, 'error'); } },
            async toggle2FA() { if (this.twoFactorEnabled) { try { await api.post('/admin/2fa/disable'); this.twoFactorEnabled = false; showToast('2FA dinonaktifkan', 'success'); } catch (e) { showToast(e.message, 'error'); } } else { try { const data = await api.post('/admin/2fa/enable'); this.qrCode = data.qrCode; this.showQR = true; } catch (e) { showToast(e.message, 'error'); } } },
            async verify2FA() { try { await api.post('/admin/2fa/verify', { code: this.verifyCode }); this.twoFactorEnabled = true; this.showQR = false; showToast('2FA diaktifkan', 'success'); } catch (e) { showToast(e.message, 'error'); } }
        };
    }
</script>
{{end}}
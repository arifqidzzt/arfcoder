{{define "chat_widget"}}
<div x-data="chatWidget()" x-show="user" class="fixed bottom-6 right-6 z-50">
    <!-- Chat Button -->
    <button @click="isOpen = !isOpen" x-show="!isOpen"
        class="w-14 h-14 bg-black text-white rounded-full shadow-xl hover:bg-gray-800 transition-all flex items-center justify-center hover:scale-110">
        <i data-lucide="message-circle" class="w-6 h-6"></i>
    </button>

    <!-- Chat Box -->
    <div x-show="isOpen" x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-150" x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 translate-y-4"
        class="w-80 h-96 bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col overflow-hidden">

        <!-- Header -->
        <div class="bg-black text-white px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i data-lucide="message-circle" class="w-5 h-5"></i>
                <span class="font-bold text-sm">Live Chat</span>
            </div>
            <button @click="isOpen = false" class="p-1 hover:bg-white/10 rounded">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>

        <!-- Messages -->
        <div class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar" id="chat-messages">
            <template x-for="msg in messages" :key="msg.id">
                <div :class="msg.isAdmin ? 'text-left' : 'text-right'">
                    <div :class="msg.isAdmin ? 'bg-gray-100 text-gray-800' : 'bg-black text-white'"
                        class="inline-block px-3 py-2 rounded-xl text-sm max-w-[80%]">
                        <span x-text="msg.content"></span>
                    </div>
                    <p class="text-[10px] text-gray-400 mt-1" x-text="formatTime(msg.createdAt)"></p>
                </div>
            </template>
            <div x-show="messages.length === 0" class="text-center text-gray-400 text-sm py-8">
                Mulai chat dengan admin...
            </div>
        </div>

        <!-- Input -->
        <form @submit.prevent="sendMessage()" class="p-3 border-t border-gray-100">
            <div class="flex gap-2">
                <input type="text" x-model="newMessage" placeholder="Ketik pesan..."
                    class="flex-1 px-3 py-2 bg-gray-50 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-black/10">
                <button type="submit" class="p-2 bg-black text-white rounded-lg hover:bg-gray-800">
                    <i data-lucide="send" class="w-4 h-4"></i>
                </button>
            </div>
        </form>
    </div>
</div>
{{end}}